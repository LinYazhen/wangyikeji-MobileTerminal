/**
 * Created by linyazhen on 15/8/20.
 */
var Slider = {
    isScrolling: false,//判断是否在运行中
    newClass: function (obj) {
        obj = obj || {};
        if (this.isScrolling == false) {
            this.init.prototype = Slider;
            /*避免Slider的原型的污染*/
            this.isScrolling = true;
        }
        return new this.init(obj);
    },
    init: function (ele) {
        this.slide = ele.slide;
        /*最外层的div*/
        this.slideBox = ele.slideBox;
        /*需要移动位置的div*/
        this.sMain = ele.sMain;
        /*滑动图片的四个div*/
        this.sItem = ele.sItem;
        /*四个li*/
        this.item = ele.item;
        /*默认的第一个li*/
        this.winWidth = window.innerWidth;
        /*手机的宽度*/
        this.slideBox.style.width = this.winWidth * this.sMain.length + 'px';
        for (var i = 0; i < this.sMain.length; i++) {
            this.sMain[i].style.width = this.winWidth + 'px';
        }
        this.bindTouch();
        /*绑定触摸事件*/
    },
    bindTouch: function () {
        var _this = this;
        var startPos = null;
        this.slide.addEventListener('touchstart', function (e) {
            //console.log(e);
            _this.isScrolling = true;
            var startTouch = e.changedTouches[0];
            startPos = {x: startTouch.pageX, y: startTouch.pageY, time: +new Date()};
            /*记录x轴 y轴的位置 和时间戳*/
            //console.log(s*/tartPos);
        }, false);

        this.slide.addEventListener('touchmove', function (e) {
            if (!_this.isScrolling) {
                return;
            } else {
                e.preventDefault();
                var moveTouch = e.changedTouches[0];
                var movePos = {x: moveTouch.pageX - startPos.x, y: moveTouch.pageY - startPos.y};
            }
            //console.log(movePos);
            _this.isScrolling = Math.abs(movePos.x) > Math.abs(movePos.y);
            if (_this.isScrolling) {
                var moveOffset = movePos.x - _this.item * _this.winWidth;
                _this.slideBox.style.webkitTransform = "translate3d(" + moveOffset + "px,0,0)";
                _this.slideBox.style.webkitTransition = "all 0.6s ease-out";
            }
        }, false);

        this.slide.addEventListener('touchend', function (e) {
                if (!_this.isScrolling) {
                    return;
                } else {
                    var duration = +new Date() - startPos.time;
                    var endTouch = e.changedTouches[0];
                    var endPos = {x: endTouch.pageX - startPos.x, y: endTouch.pageY - startPos.y};
                    /*计算位移*/
                    //console.log(endPos);
                    if (Number(duration) > 10) {
                        if (Math.abs(endPos.x) > 10) {
                            if (endPos.x > 0) {
                                if (_this.item == 0) {
                                    _this.isScrolling = false;
                                    _this.animate();
                                    /*回弹*/
                                } else {
                                    _this.prevPage();
                                    /*往左*/
                                }
                            } else if (endPos.x < 0) {
                                if (_this.item == _this.sMain.length - 1) {
                                    _this.isScrolling = false;
                                    _this.animate();
                                } else {
                                    _this.nextPage();
                                }
                            }
                        }
                    }
                }
            }
            ,
            false
        )
    },
    nextPage: function () {
        if (this.item == this.sMain.length - 1) {
            return;
        }
        this.item++;
        this.animate();//处理动画效果
        this.curItem(this.item);//处理li的显示
    }

    ,
    prevPage: function () {
        if (this.item == 0) {
            return;
        }
        this.item--;
        this.animate();//处理动画效果
        this.curItem(this.item);//处理li的显示
    }
    ,
    curItem: function (setItem) {
        for (var i = 0; i < this.sItem.length; i++) {
            this.sItem[i].className = '';
        }
        this.sItem[setItem].className = 'cur';
    }
    ,
    animate: function () {
        //transfrom:translate3d(tx,0,0);/*用3D变形来开启CPU*/
        var setEq = -(this.item * this.winWidth) + 'px';
        this.slideBox.style.webkitTransition = "all 0.6s ease-out";
        this.slideBox.style.webkitTransform = "translate3d(" + setEq + ",0,0)";

    },
};


//初始化
var obj = {
    slide: document.querySelector(".slide"),
    slideBox: document.querySelector(".slide-box"),
    sMain: document.querySelectorAll(".sMain"),
    sItem: document.querySelector(".slide-item").getElementsByTagName("li"),
    item: 0
};

Slider.newClass(obj);
/*回到顶部*/
var toTop = document.querySelector(".toTop");
toTop.addEventListener("click", function(){
    var timer = window.setInterval(function () {
        document.body.scrollTop -= 100;
        if (document.body.scrollTop === 0) {
            window.clearInterval(timer);
        }
    }, 15);
},false);
/*加载更多*/
var hide=document.querySelector(".hide");
var more=document.querySelector(".more");
more.addEventListener("click", function(){
    hide.style.display="block";
},false);



























